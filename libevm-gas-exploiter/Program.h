#pragma once

#include <vector>
#include <map>
#include <libdevcore/Common.h>

#include <libevm/Instruction.h>


namespace dev
{
namespace eth
{

struct ProgramData
{
    ProgramData(u256 _value, uint8_t _size) : value(_value), size(_size) {}
    u256 value;
    uint8_t size;
};

class ProgramInstruction
{
public:
    ProgramInstruction(Instruction instruction) : m_instruction(instruction) {}
    bool hasData() const { return false; }
    Instruction instruction() const { return m_instruction; }

protected:
    Instruction m_instruction;
};

class ProgramInstructionWithData : public ProgramInstruction
{
public:
    ProgramInstructionWithData(Instruction instruction, ProgramData data)
        : ProgramInstruction(instruction), m_data(data) {}
    bool hasData() const { return true; }
private:
    ProgramData m_data;
};

class Program
{
public:
    Program();
    explicit Program(std::vector<ProgramInstruction> instructions);

    void addInstruction(ProgramInstruction instruction);
    std::vector<ProgramInstruction> instructions() const { return m_instructions; };
    uint64_t stackSize() const { return m_stackSize; };

    std::string toBytecode() const;

private:
    /// m_instructions is the vector of instructions in the program
    std::vector<ProgramInstruction> m_instructions;

    /// m_stackSize is the current size of the program stack
    /// i.e. the size the stack would be if we executed all the instructions
    /// of the program
    uint64_t m_stackSize = 0;
};

}
}
